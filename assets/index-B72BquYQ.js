(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const Y=11102230246251565e-32,B=134217729,kt=(3+8*Y)*Y;function at(a,t,e,i,n){let s,l,o,h,r=t[0],f=i[0],c=0,u=0;f>r==f>-r?(s=r,r=t[++c]):(s=f,f=i[++u]);let d=0;if(c<a&&u<e)for(f>r==f>-r?(l=r+s,o=s-(l-r),r=t[++c]):(l=f+s,o=s-(l-f),f=i[++u]),s=l,o!==0&&(n[d++]=o);c<a&&u<e;)f>r==f>-r?(l=s+r,h=l-s,o=s-(l-h)+(r-h),r=t[++c]):(l=s+f,h=l-s,o=s-(l-h)+(f-h),f=i[++u]),s=l,o!==0&&(n[d++]=o);for(;c<a;)l=s+r,h=l-s,o=s-(l-h)+(r-h),r=t[++c],s=l,o!==0&&(n[d++]=o);for(;u<e;)l=s+f,h=l-s,o=s-(l-h)+(f-h),f=i[++u],s=l,o!==0&&(n[d++]=o);return(s!==0||d===0)&&(n[d++]=s),d}function $t(a,t){let e=t[0];for(let i=1;i<a;i++)e+=t[i];return e}function et(a){return new Float64Array(a)}const Et=(3+16*Y)*Y,Pt=(2+12*Y)*Y,jt=(9+64*Y)*Y*Y,X=et(4),_t=et(8),yt=et(12),pt=et(16),U=et(4);function Lt(a,t,e,i,n,s,l){let o,h,r,f,c,u,d,m,g,p,_,b,I,A,M,$,P,T;const y=a-n,v=e-n,w=t-s,S=i-s;A=y*S,u=B*y,d=u-(u-y),m=y-d,u=B*S,g=u-(u-S),p=S-g,M=m*p-(A-d*g-m*g-d*p),$=w*v,u=B*w,d=u-(u-w),m=w-d,u=B*v,g=u-(u-v),p=v-g,P=m*p-($-d*g-m*g-d*p),_=M-P,c=M-_,X[0]=M-(_+c)+(c-P),b=A+_,c=b-A,I=A-(b-c)+(_-c),_=I-$,c=I-_,X[1]=I-(_+c)+(c-$),T=b+_,c=T-b,X[2]=b-(T-c)+(_-c),X[3]=T;let E=$t(4,X),j=Pt*l;if(E>=j||-E>=j||(c=a-y,o=a-(y+c)+(c-n),c=e-v,r=e-(v+c)+(c-n),c=t-w,h=t-(w+c)+(c-s),c=i-S,f=i-(S+c)+(c-s),o===0&&h===0&&r===0&&f===0)||(j=jt*l+kt*Math.abs(E),E+=y*f+S*o-(w*r+v*h),E>=j||-E>=j))return E;A=o*S,u=B*o,d=u-(u-o),m=o-d,u=B*S,g=u-(u-S),p=S-g,M=m*p-(A-d*g-m*g-d*p),$=h*v,u=B*h,d=u-(u-h),m=h-d,u=B*v,g=u-(u-v),p=v-g,P=m*p-($-d*g-m*g-d*p),_=M-P,c=M-_,U[0]=M-(_+c)+(c-P),b=A+_,c=b-A,I=A-(b-c)+(_-c),_=I-$,c=I-_,U[1]=I-(_+c)+(c-$),T=b+_,c=T-b,U[2]=b-(T-c)+(_-c),U[3]=T;const F=at(4,X,4,U,_t);A=y*f,u=B*y,d=u-(u-y),m=y-d,u=B*f,g=u-(u-f),p=f-g,M=m*p-(A-d*g-m*g-d*p),$=w*r,u=B*w,d=u-(u-w),m=w-d,u=B*r,g=u-(u-r),p=r-g,P=m*p-($-d*g-m*g-d*p),_=M-P,c=M-_,U[0]=M-(_+c)+(c-P),b=A+_,c=b-A,I=A-(b-c)+(_-c),_=I-$,c=I-_,U[1]=I-(_+c)+(c-$),T=b+_,c=T-b,U[2]=b-(T-c)+(_-c),U[3]=T;const x=at(F,_t,4,U,yt);A=o*f,u=B*o,d=u-(u-o),m=o-d,u=B*f,g=u-(u-f),p=f-g,M=m*p-(A-d*g-m*g-d*p),$=h*r,u=B*h,d=u-(u-h),m=h-d,u=B*r,g=u-(u-r),p=r-g,P=m*p-($-d*g-m*g-d*p),_=M-P,c=M-_,U[0]=M-(_+c)+(c-P),b=A+_,c=b-A,I=A-(b-c)+(_-c),_=I-$,c=I-_,U[1]=I-(_+c)+(c-$),T=b+_,c=T-b,U[2]=b-(T-c)+(_-c),U[3]=T;const L=at(x,yt,4,U,pt);return pt[L-1]}function nt(a,t,e,i,n,s){const l=(t-s)*(e-n),o=(a-n)*(i-s),h=l-o,r=Math.abs(l+o);return Math.abs(h)>=Et*r?h:-Lt(a,t,e,i,n,s,r)}const bt=Math.pow(2,-52),it=new Uint32Array(512);class lt{static from(t,e=Dt,i=zt){const n=t.length,s=new Float64Array(n*2);for(let l=0;l<n;l++){const o=t[l];s[2*l]=e(o),s[2*l+1]=i(o)}return new lt(s)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:n,_hullHash:s}=this,l=t.length>>1;let o=1/0,h=1/0,r=-1/0,f=-1/0;for(let y=0;y<l;y++){const v=t[2*y],w=t[2*y+1];v<o&&(o=v),w<h&&(h=w),v>r&&(r=v),w>f&&(f=w),this._ids[y]=y}const c=(o+r)/2,u=(h+f)/2;let d,m,g;for(let y=0,v=1/0;y<l;y++){const w=ut(c,u,t[2*y],t[2*y+1]);w<v&&(d=y,v=w)}const p=t[2*d],_=t[2*d+1];for(let y=0,v=1/0;y<l;y++){if(y===d)continue;const w=ut(p,_,t[2*y],t[2*y+1]);w<v&&w>0&&(m=y,v=w)}let b=t[2*m],I=t[2*m+1],A=1/0;for(let y=0;y<l;y++){if(y===d||y===m)continue;const v=Bt(p,_,b,I,t[2*y],t[2*y+1]);v<A&&(g=y,A=v)}let M=t[2*g],$=t[2*g+1];if(A===1/0){for(let w=0;w<l;w++)this._dists[w]=t[2*w]-t[0]||t[2*w+1]-t[1];W(this._ids,this._dists,0,l-1);const y=new Uint32Array(l);let v=0;for(let w=0,S=-1/0;w<l;w++){const E=this._ids[w],j=this._dists[E];j>S&&(y[v++]=E,S=j)}this.hull=y.subarray(0,v),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(nt(p,_,b,I,M,$)<0){const y=m,v=b,w=I;m=g,b=M,I=$,g=y,M=v,$=w}const P=Ut(p,_,b,I,M,$);this._cx=P.x,this._cy=P.y;for(let y=0;y<l;y++)this._dists[y]=ut(t[2*y],t[2*y+1],P.x,P.y);W(this._ids,this._dists,0,l-1),this._hullStart=d;let T=3;i[d]=e[g]=m,i[m]=e[d]=g,i[g]=e[m]=d,n[d]=0,n[m]=1,n[g]=2,s.fill(-1),s[this._hashKey(p,_)]=d,s[this._hashKey(b,I)]=m,s[this._hashKey(M,$)]=g,this.trianglesLen=0,this._addTriangle(d,m,g,-1,-1,-1);for(let y=0,v,w;y<this._ids.length;y++){const S=this._ids[y],E=t[2*S],j=t[2*S+1];if(y>0&&Math.abs(E-v)<=bt&&Math.abs(j-w)<=bt||(v=E,w=j,S===d||S===m||S===g))continue;let F=0;for(let V=0,Mt=this._hashKey(E,j);V<this._hashSize&&(F=s[(Mt+V)%this._hashSize],!(F!==-1&&F!==i[F]));V++);F=e[F];let x=F,L;for(;L=i[x],nt(E,j,t[2*x],t[2*x+1],t[2*L],t[2*L+1])>=0;)if(x=L,x===F){x=-1;break}if(x===-1)continue;let z=this._addTriangle(x,S,i[x],-1,-1,n[x]);n[S]=this._legalize(z+2),n[x]=z,T++;let C=i[x];for(;L=i[C],nt(E,j,t[2*C],t[2*C+1],t[2*L],t[2*L+1])<0;)z=this._addTriangle(C,S,L,n[S],-1,n[C]),n[S]=this._legalize(z+2),i[C]=C,T--,C=L;if(x===F)for(;L=e[x],nt(E,j,t[2*L],t[2*L+1],t[2*x],t[2*x+1])<0;)z=this._addTriangle(L,S,x,-1,n[x],n[L]),this._legalize(z+2),n[L]=z,i[x]=x,T--,x=L;this._hullStart=e[S]=x,i[x]=e[C]=S,i[S]=C,s[this._hashKey(E,j)]=S,s[this._hashKey(t[2*x],t[2*x+1])]=x}this.hull=new Uint32Array(T);for(let y=0,v=this._hullStart;y<T;y++)this.hull[y]=v,v=i[v];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(Ft(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:n}=this;let s=0,l=0;for(;;){const o=i[t],h=t-t%3;if(l=h+(t+2)%3,o===-1){if(s===0)break;t=it[--s];continue}const r=o-o%3,f=h+(t+1)%3,c=r+(o+2)%3,u=e[l],d=e[t],m=e[f],g=e[c];if(Ct(n[2*u],n[2*u+1],n[2*d],n[2*d+1],n[2*m],n[2*m+1],n[2*g],n[2*g+1])){e[t]=g,e[o]=u;const _=i[c];if(_===-1){let I=this._hullStart;do{if(this._hullTri[I]===c){this._hullTri[I]=t;break}I=this._hullPrev[I]}while(I!==this._hullStart)}this._link(t,_),this._link(o,i[l]),this._link(l,c);const b=r+(o+1)%3;s<it.length&&(it[s++]=b)}else{if(s===0)break;t=it[--s]}}return l}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,i,n,s,l){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=i,this._link(o,n),this._link(o+1,s),this._link(o+2,l),this.trianglesLen+=3,o}}function Ft(a,t){const e=a/(Math.abs(a)+Math.abs(t));return(t>0?3-e:1+e)/4}function ut(a,t,e,i){const n=a-e,s=t-i;return n*n+s*s}function Ct(a,t,e,i,n,s,l,o){const h=a-l,r=t-o,f=e-l,c=i-o,u=n-l,d=s-o,m=h*h+r*r,g=f*f+c*c,p=u*u+d*d;return h*(c*p-g*d)-r*(f*p-g*u)+m*(f*d-c*u)<0}function Bt(a,t,e,i,n,s){const l=e-a,o=i-t,h=n-a,r=s-t,f=l*l+o*o,c=h*h+r*r,u=.5/(l*r-o*h),d=(r*f-o*c)*u,m=(l*c-h*f)*u;return d*d+m*m}function Ut(a,t,e,i,n,s){const l=e-a,o=i-t,h=n-a,r=s-t,f=l*l+o*o,c=h*h+r*r,u=.5/(l*r-o*h),d=a+(r*f-o*c)*u,m=t+(l*c-h*f)*u;return{x:d,y:m}}function W(a,t,e,i){if(i-e<=20)for(let n=e+1;n<=i;n++){const s=a[n],l=t[s];let o=n-1;for(;o>=e&&t[a[o]]>l;)a[o+1]=a[o--];a[o+1]=s}else{const n=e+i>>1;let s=e+1,l=i;J(a,n,s),t[a[e]]>t[a[i]]&&J(a,e,i),t[a[s]]>t[a[i]]&&J(a,s,i),t[a[e]]>t[a[s]]&&J(a,e,s);const o=a[s],h=t[o];for(;;){do s++;while(t[a[s]]<h);do l--;while(t[a[l]]>h);if(l<s)break;J(a,s,l)}a[e+1]=a[l],a[l]=o,i-s+1>=l-e?(W(a,t,s,i),W(a,t,e,l-1)):(W(a,t,e,l-1),W(a,t,s,i))}}function J(a,t,e){const i=a[t];a[t]=a[e],a[e]=i}function Dt(a){return a[0]}function zt(a){return a[1]}const wt=1e-6;class K{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,i){t=+t,e=+e,i=+i;const n=t+i,s=e;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${s}`:(Math.abs(this._x1-n)>wt||Math.abs(this._y1-s)>wt)&&(this._+="L"+n+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${e}A${i},${i},0,1,1,${this._x1=n},${this._y1=s}`)}rect(t,e,i,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+i}v${+n}h${-i}Z`}value(){return this._||null}}class ft{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Nt{constructor(t,[e,i,n,s]=[0,0,960,500]){if(!((n=+n)>=(e=+e))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=n,this.xmin=e,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:n}=this;let s,l;const o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,p=0,_=i.length,b,I;g<_;g+=3,p+=2){const A=i[g]*2,M=i[g+1]*2,$=i[g+2]*2,P=t[A],T=t[A+1],y=t[M],v=t[M+1],w=t[$],S=t[$+1],E=y-P,j=v-T,F=w-P,x=S-T,L=(E*x-j*F)*2;if(Math.abs(L)<1e-9){if(s===void 0){s=l=0;for(const C of e)s+=t[C*2],l+=t[C*2+1];s/=e.length,l/=e.length}const z=1e9*Math.sign((s-P)*x-(l-T)*F);b=(P+w)/2-z*x,I=(T+S)/2+z*F}else{const z=1/L,C=E*E+j*j,V=F*F+x*x;b=P+(x*C-j*V)*z,I=T+(E*V-F*C)*z}o[p]=b,o[p+1]=I}let h=e[e.length-1],r,f=h*4,c,u=t[2*h],d,m=t[2*h+1];n.fill(0);for(let g=0;g<e.length;++g)h=e[g],r=f,c=u,d=m,f=h*4,u=t[2*h],m=t[2*h+1],n[r+2]=n[f]=d-m,n[r+3]=n[f+1]=u-c}render(t){const e=t==null?t=new K:void 0,{delaunay:{halfedges:i,inedges:n,hull:s},circumcenters:l,vectors:o}=this;if(s.length<=1)return null;for(let f=0,c=i.length;f<c;++f){const u=i[f];if(u<f)continue;const d=Math.floor(f/3)*2,m=Math.floor(u/3)*2,g=l[d],p=l[d+1],_=l[m],b=l[m+1];this._renderSegment(g,p,_,b,t)}let h,r=s[s.length-1];for(let f=0;f<s.length;++f){h=r,r=s[f];const c=Math.floor(n[r]/3)*2,u=l[c],d=l[c+1],m=h*4,g=this._project(u,d,o[m+2],o[m+3]);g&&this._renderSegment(u,d,g[0],g[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new K:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const i=e==null?e=new K:void 0,n=this._clip(t);if(n===null||!n.length)return;e.moveTo(n[0],n[1]);let s=n.length;for(;n[0]===n[s-2]&&n[1]===n[s-1]&&s>1;)s-=2;for(let l=2;l<s;l+=2)(n[l]!==n[l-2]||n[l+1]!==n[l-1])&&e.lineTo(n[l],n[l+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const n=this.cellPolygon(e);n&&(n.index=e,yield n)}}cellPolygon(t){const e=new ft;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,n,s){let l;const o=this._regioncode(t,e),h=this._regioncode(i,n);o===0&&h===0?(s.moveTo(t,e),s.lineTo(i,n)):(l=this._clipSegment(t,e,i,n,o,h))&&(s.moveTo(l[0],l[1]),s.lineTo(l[2],l[3]))}contains(t,e,i){return e=+e,e!==e||(i=+i,i!==i)?!1:this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const n=this._clip(i);if(n){t:for(let s=0,l=e.length;s<l;s+=2)for(let o=0,h=n.length;o<h;o+=2)if(e[s]===n[o]&&e[s+1]===n[o+1]&&e[(s+2)%l]===n[(o+h-2)%h]&&e[(s+3)%l]===n[(o+h-1)%h]){yield i;break t}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:n,triangles:s}}=this,l=i[t];if(l===-1)return null;const o=[];let h=l;do{const r=Math.floor(h/3);if(o.push(e[r*2],e[r*2+1]),h=h%3===2?h-2:h+1,s[h]!==t)break;h=n[h]}while(h!==l&&h!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(e===null)return null;const{vectors:i}=this,n=t*4;return this._simplify(i[n]||i[n+1]?this._clipInfinite(t,e,i[n],i[n+1],i[n+2],i[n+3]):this._clipFinite(t,e))}_clipFinite(t,e){const i=e.length;let n=null,s,l,o=e[i-2],h=e[i-1],r,f=this._regioncode(o,h),c,u=0;for(let d=0;d<i;d+=2)if(s=o,l=h,o=e[d],h=e[d+1],r=f,f=this._regioncode(o,h),r===0&&f===0)c=u,u=0,n?n.push(o,h):n=[o,h];else{let m,g,p,_,b;if(r===0){if((m=this._clipSegment(s,l,o,h,r,f))===null)continue;[g,p,_,b]=m}else{if((m=this._clipSegment(o,h,s,l,f,r))===null)continue;[_,b,g,p]=m,c=u,u=this._edgecode(g,p),c&&u&&this._edge(t,c,u,n,n.length),n?n.push(g,p):n=[g,p]}c=u,u=this._edgecode(_,b),c&&u&&this._edge(t,c,u,n,n.length),n?n.push(_,b):n=[_,b]}if(n)c=u,u=this._edgecode(n[0],n[1]),c&&u&&this._edge(t,c,u,n,n.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(t,e,i,n,s,l){const o=s<l;for(o&&([t,e,i,n,s,l]=[i,n,t,e,l,s]);;){if(s===0&&l===0)return o?[i,n,t,e]:[t,e,i,n];if(s&l)return null;let h,r,f=s||l;f&8?(h=t+(i-t)*(this.ymax-e)/(n-e),r=this.ymax):f&4?(h=t+(i-t)*(this.ymin-e)/(n-e),r=this.ymin):f&2?(r=e+(n-e)*(this.xmax-t)/(i-t),h=this.xmax):(r=e+(n-e)*(this.xmin-t)/(i-t),h=this.xmin),s?(t=h,e=r,s=this._regioncode(t,e)):(i=h,n=r,l=this._regioncode(i,n))}}_clipInfinite(t,e,i,n,s,l){let o=Array.from(e),h;if((h=this._project(o[0],o[1],i,n))&&o.unshift(h[0],h[1]),(h=this._project(o[o.length-2],o[o.length-1],s,l))&&o.push(h[0],h[1]),o=this._clipFinite(t,o))for(let r=0,f=o.length,c,u=this._edgecode(o[f-2],o[f-1]);r<f;r+=2)c=u,u=this._edgecode(o[r],o[r+1]),c&&u&&(r=this._edge(t,c,u,o,r),f=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,i,n,s){for(;e!==i;){let l,o;switch(e){case 5:e=4;continue;case 4:e=6,l=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,l=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,l=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,l=this.xmin,o=this.ymin;break}(n[s]!==l||n[s+1]!==o)&&this.contains(t,l,o)&&(n.splice(s,0,l,o),s+=2)}return s}_project(t,e,i,n){let s=1/0,l,o,h;if(n<0){if(e<=this.ymin)return null;(l=(this.ymin-e)/n)<s&&(h=this.ymin,o=t+(s=l)*i)}else if(n>0){if(e>=this.ymax)return null;(l=(this.ymax-e)/n)<s&&(h=this.ymax,o=t+(s=l)*i)}if(i>0){if(t>=this.xmax)return null;(l=(this.xmax-t)/i)<s&&(o=this.xmax,h=e+(s=l)*n)}else if(i<0){if(t<=this.xmin)return null;(l=(this.xmin-t)/i)<s&&(o=this.xmin,h=e+(s=l)*n)}return[o,h]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const i=(e+2)%t.length,n=(e+4)%t.length;(t[e]===t[i]&&t[i]===t[n]||t[e+1]===t[i+1]&&t[i+1]===t[n+1])&&(t.splice(i,2),e-=2)}t.length||(t=null)}return t}}const Ot=2*Math.PI,q=Math.pow;function Rt(a){return a[0]}function Yt(a){return a[1]}function Ht(a){const{triangles:t,coords:e}=a;for(let i=0;i<t.length;i+=3){const n=2*t[i],s=2*t[i+1],l=2*t[i+2];if((e[l]-e[n])*(e[s+1]-e[n+1])-(e[s]-e[n])*(e[l+1]-e[n+1])>1e-10)return!1}return!0}function Kt(a,t,e){return[a+Math.sin(a+t)*e,t+Math.cos(a-t)*e]}class ot{static from(t,e=Rt,i=Yt,n){return new ot("length"in t?Vt(t,e,i,n):Float64Array.from(Xt(t,e,i,n)))}constructor(t){this._delaunator=new lt(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&Ht(t)){this.collinear=Int32Array.from({length:e.length/2},(u,d)=>d).sort((u,d)=>e[2*u]-e[2*d]||e[2*u+1]-e[2*d+1]);const h=this.collinear[0],r=this.collinear[this.collinear.length-1],f=[e[2*h],e[2*h+1],e[2*r],e[2*r+1]],c=1e-8*Math.hypot(f[3]-f[1],f[2]-f[0]);for(let u=0,d=e.length/2;u<d;++u){const m=Kt(e[2*u],e[2*u+1],c);e[2*u]=m[0],e[2*u+1]=m[1]}this._delaunator=new lt(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,l=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let h=0,r=i.length;h<r;++h){const f=s[h%3===2?h-2:h+1];(i[h]===-1||l[f]===-1)&&(l[f]=h)}for(let h=0,r=n.length;h<r;++h)o[n[h]]=h;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],l[n[0]]=1,n.length===2&&(l[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(t){return new Nt(this,t)}*neighbors(t){const{inedges:e,hull:i,_hullIndex:n,halfedges:s,triangles:l,collinear:o}=this;if(o){const c=o.indexOf(t);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const h=e[t];if(h===-1)return;let r=h,f=-1;do{if(yield f=l[r],r=r%3===2?r-2:r+1,l[r]!==t)return;if(r=s[r],r===-1){const c=i[(n[t]+1)%i.length];c!==f&&(yield c);return}}while(r!==h)}find(t,e,i=0){if(t=+t,t!==t||(e=+e,e!==e))return-1;const n=i;let s;for(;(s=this._step(i,t,e))>=0&&s!==i&&s!==n;)i=s;return s}_step(t,e,i){const{inedges:n,hull:s,_hullIndex:l,halfedges:o,triangles:h,points:r}=this;if(n[t]===-1||!r.length)return(t+1)%(r.length>>1);let f=t,c=q(e-r[t*2],2)+q(i-r[t*2+1],2);const u=n[t];let d=u;do{let m=h[d];const g=q(e-r[m*2],2)+q(i-r[m*2+1],2);if(g<c&&(c=g,f=m),d=d%3===2?d-2:d+1,h[d]!==t)break;if(d=o[d],d===-1){if(d=s[(l[t]+1)%s.length],d!==m&&q(e-r[d*2],2)+q(i-r[d*2+1],2)<c)return d;break}}while(d!==u);return f}render(t){const e=t==null?t=new K:void 0,{points:i,halfedges:n,triangles:s}=this;for(let l=0,o=n.length;l<o;++l){const h=n[l];if(h<l)continue;const r=s[l]*2,f=s[h]*2;t.moveTo(i[r],i[r+1]),t.lineTo(i[f],i[f+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){e===void 0&&(!t||typeof t.moveTo!="function")&&(e=t,t=null),e=e==null?2:+e;const i=t==null?t=new K:void 0,{points:n}=this;for(let s=0,l=n.length;s<l;s+=2){const o=n[s],h=n[s+1];t.moveTo(o+e,h),t.arc(o,h,e,0,Ot)}return i&&i.value()}renderHull(t){const e=t==null?t=new K:void 0,{hull:i,points:n}=this,s=i[0]*2,l=i.length;t.moveTo(n[s],n[s+1]);for(let o=1;o<l;++o){const h=2*i[o];t.lineTo(n[h],n[h+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new ft;return this.renderHull(t),t.value()}renderTriangle(t,e){const i=e==null?e=new K:void 0,{points:n,triangles:s}=this,l=s[t*=3]*2,o=s[t+1]*2,h=s[t+2]*2;return e.moveTo(n[l],n[l+1]),e.lineTo(n[o],n[o+1]),e.lineTo(n[h],n[h+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,i=t.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new ft;return this.renderTriangle(t,e),e.value()}}function Vt(a,t,e,i){const n=a.length,s=new Float64Array(n*2);for(let l=0;l<n;++l){const o=a[l];s[l*2]=t.call(i,o,l,a),s[l*2+1]=e.call(i,o,l,a)}return s}function*Xt(a,t,e,i){let n=0;for(const s of a)yield t.call(i,s,n,a),yield e.call(i,s,n,a),++n}const qt=1;function Wt(a,t,e,i="black",n=qt){a.fillStyle=i,a.beginPath(),a.arc(t,e,n,0,Math.PI*2),a.fill()}function vt(a,t,e){return[a[0]+(t[0]-a[0])*e,a[1]+(t[1]-a[1])*e]}let N=[],tt,dt,R=null,G=document.createElement("canvas");const H=document.getElementById("video");let Z=!1;const k=document.getElementById("canvas"),Gt=document.getElementById("colorToggle"),Qt=document.getElementById("polyToggle"),It=document.getElementById("minRadius"),gt=document.getElementById("maxRadius"),rt=document.getElementById("numPointsSlider"),Zt=document.getElementById("imageUpload"),xt=document.getElementById("loader"),St=document.getElementById("controls"),Jt=document.getElementById("restart-btn"),O=k.getContext("2d");let Q,D;function ht(){const a=parseInt(rt.value);(isNaN(a)||a<=0)&&(a=15e3),N=[];for(let t=0;t<a;t++){let e=Math.random()*k.width,i=Math.random()*k.height;const n=Math.floor(e),l=(Math.floor(i)*k.width+n)*4,o=D[l],h=D[l+1],r=D[l+2],f=.2126*o+.7152*h+.0722*r;Math.random()*255>f?N.push([e,i]):t--}}function At(a){console.log("original image size",a.width,a.height),R!==null&&(cancelAnimationFrame(R),R=null),k.style.display="block",St.style.display="flex",xt.style.display="none";let t=a.width,e=a.height;if(a.width>800){console.log("resizing");const i=800/a.width;t=800,e=a.height*i}G.width=t,G.height=e,k.width=t,k.height=e,Q=G.getContext("2d"),Q.drawImage(a,0,0,t,e),D=Q.getImageData(0,0,k.width,k.height).data,ht(),ct(),mt()}function ct(){tt=ot.from(N),dt=tt.voronoi([0,0,k.width,k.height])}function mt(){O.clearRect(0,0,k.width,k.height),Z&&Q.drawImage(H,0,0,k.width,k.height),D=Q.getImageData(0,0,k.width,k.height).data;const a=Gt.checked,t=Qt.checked,e=parseFloat(It.value),i=parseFloat(gt.value);if(!t)for(let r=0;r<N.length;r++){const f=N[r],c=Math.floor(f[0]),d=(Math.floor(f[1])*k.width+c)*4,m=D[d],g=D[d+1],p=D[d+2],I=1-(.2126*m+.7152*g+.0722*p)/255,A=e+I*(i-e),M=a?`rgb(${m}, ${g}, ${p})`:"black";O.globalAlpha=.9,Wt(O,f[0],f[1],M,A)}let n=dt.cellPolygons(),s=Array.from(n);if(t)for(let r=0;r<s.length;r++){const f=s[r];O.beginPath(),O.moveTo(f[0][0],f[0][1]);for(let c=1;c<f.length;c++)O.lineTo(f[c][0],f[c][1]);if(O.closePath(),a){const c=N[r],u=Math.floor(c[0]),m=(Math.floor(c[1])*k.width+u)*4,g=D[m],p=D[m+1],_=D[m+2],b=`rgb(${g}, ${p}, ${_})`;O.fillStyle=b,O.fill()}else O.stroke()}let l=new Array(s.length);for(let r=0;r<l.length;r++)l[r]=[0,0];let o=new Array(s.length).fill(0),h=0;for(let r=0;r<k.width;r++)for(let f=0;f<k.height;f++){const c=(f*k.width+r)*4,u=D[c],d=D[c+1],m=D[c+2];let p=1-(.2126*u+.7152*d+.0722*m)/255;h=tt.find(r,f,h),l[h][0]+=r*p,l[h][1]+=f*p,o[h]+=p}for(let r=0;r<l.length;r++)o[r]>0?(l[r][0]/=o[r],l[r][1]/=o[r]):l[r]=[...N[r]];for(let r=0;r<l.length;r++);for(let r=0;r<N.length;r++)Z?N[r]=vt(N[r],l[r],1):N[r]=vt(N[r],l[r],.5);tt=ot.from(N),dt=tt.voronoi([0,0,k.width,k.height]),R=requestAnimationFrame(mt)}async function te(){R!==null&&(cancelAnimationFrame(R),R=null,H.pause(),Z=!1,Tt())}async function ee(){R!==null&&(cancelAnimationFrame(R),R=null);const a=await navigator.mediaDevices.getUserMedia({video:!0});H.srcObject=a,await H.play(),Z=!0;const t=H.videoWidth,e=H.videoHeight;k.width=t,k.height=e,G.width=t,G.height=e,Q=G.getContext("2d"),rt.value=1e3,gt.value=5,ht(),ct(),mt()}function Tt(){const a=new Image;a.src=a.src="/voronoi-stippling/cat-square.jpg",a.onload=async()=>{await customElements.whenDefined("sl-range"),await Promise.all([It.updateComplete,gt.updateComplete,rt.updateComplete]),At(a)}}Tt();Zt.addEventListener("change",a=>{const t=a.target.files[0];if(!t)return;k.style.display="none",St.style.display="none",xt.style.display="inline-block",H&&(H.pause(),st.innerText="Live Video"),Z=!1;const e=new FileReader;e.onload=i=>{const n=new Image;n.onload=()=>{At(n)},n.src=i.target.result},e.readAsDataURL(t)});rt.addEventListener("input",()=>{ht(),ct()});Jt.addEventListener("click",()=>{ht(),ct()});const st=document.getElementById("video-btn");st.addEventListener("click",()=>{Z?(te(),st.innerText="Live Video"):(ee(),st.innerText="Stop Video")});
